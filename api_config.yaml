# https://cloud.google.com/endpoints/docs/grpc-service-config/reference/rpc/google.api#service

type: google.api.Service
config_version: 3

#
# Name of the service configuration.
#
name: users.endpoints.analyticsframework.cloud.goog

# API title to appear in the user interface (Google Cloud Console).
title: Datasets Users API

# Should match the service as defined in api.proto
apis:
- name: magicleap.datasets.users.Users

# https://cloud.google.com/endpoints/docs/grpc/grpc-dns-configure
endpoints:
- name: users.endpoints.analyticsframework.cloud.goog
  allow_cors: true
  target: "104.198.144.78"

# Request authentication.
authentication:
  providers:
  - id: google_id_token
    issuer: https://accounts.google.com
    audiences: |
      439260306570-b8ehja938h32vbl9jb6s2ml4tl8pk9s2.apps.googleusercontent.com,
      763597474440-jitt7oqo7jppgg497dq4ae9uq5japai5.apps.googleusercontent.com,
      439260306570-1hs8vdfr2p5pkffuml6rtbbm503dsphc.apps.googleusercontent.com

# allowed_client_ids = [
#     '439260306570-b8ehja938h32vbl9jb6s2ml4tl8pk9s2.apps.googleusercontent.com', # CLI  # noqa
#     '763597474440-jitt7oqo7jppgg497dq4ae9uq5japai5.apps.googleusercontent.com', # datasets-frontend # noqa
#     '439260306570-1hs8vdfr2p5pkffuml6rtbbm503dsphc.apps.googleusercontent.com', # Web UI  # noqa
#     '141530362265-ucisfckjpadkc4v002ibkc5aeacaqstv.apps.googleusercontent.com', # eguendelman's # noqa
#     '107918144537744202871', # analyticsframework@appspot.gserviceaccount.com --> default  # noqa
#     '103311373514881609732', # batch-runner@analyticsframework.iam.gserviceaccount.com  # noqa
#     '115896839819721072399', # head-pose-batch-eval@analyticsframework.iam.gserviceaccount.com  # noqa
#     '110050846120109587941', # gaze-batch-eval@analyticsframework.iam.gserviceaccount.com  # noqa
#     '111014016425078685290', # sipp-extractor@analyticsframework.iam.gserviceaccount.com  # noqa
#     '116369930344624784826', # worker-sensor-ramon-sensim@analyticsframework.iam.gserviceaccount.com  # noqa
#     '104377765709731293974', # datasets-development-environme@analyticsframework.iam.gserviceaccount.com  # noqa
# ]


  - id: datasets_auth_provider

    # JWT issuer (Users API)
    issuer: https://users.datasets.magicleap.com

    # This is the public key endpoint for the Service Account used to sign the JWT
    # https://cloud.google.com/iam/docs/creating-managing-service-account-keys/
    jwks_uri: https://www.googleapis.com/service_accounts/v1/metadata/x509/analyticsframework@appspot.gserviceaccount.com

    # Accept only JWT with any of these audiences
    audiences: https://metrics.datasets.magicleap.com,https://*.datasets.magicleap.com,https://datasets.magicleap.com

  rules:
  # This auth rule will apply to all methods.
  - selector: "*"
    requirements:
      - provider_id: datasets_auth_provider
  - selector: "magicleap.datasets.users.Users.CreateToken"
    requirements:
      - provider_id: google_id_token
